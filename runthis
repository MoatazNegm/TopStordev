#! /usr/local/bin/zsh
cd /TopStor
# command is newcom paramaters (at least one)
echo $@ > tmprep2
sendertun=`echo  $@ | awk '{print $1}'`;
sender=`echo  $@ | awk '{print $2}'`;
replier=`echo  $@ | awk '{print $3}'`;
senderpp=`echo  $@ | awk '{print $4}'`;
pp=`echo  $@ | awk '{print $5}'`;
tun=`echo  $@ | awk '{print $6}'`;
newcom=`echo  $@ | awk '{print $7}'`;
param=`echo  $@ | awk '{$1=$2=$3=$4=$5=$6=$7="";print substr($0,8)}'`;
# packet : sender stamp command
isvalid=`cat Commands.txt | grep "$newcom"`
if [[ $? -eq 0 ]];
then 
 validcom=$isvalid" "$param;
 res=`eval $validcom`
 echo $validcom  > tmp2runthis 
 echo res=$res >> tmp2runthis
 ppp=$((senderpp+1));
 echo Askreply $replier $sendertun $ppp reply $res > tmprep
 ./Askreply $replier $sendertun $ppp reply $res
fi
echo isvalid=$isvalid  >> tmp2runthis 
